<HTML>
<TITLE>
uri_utils
</TITLE>
<BODY>
<H1>File: uri_utils.sql</H1>
<H2>Type: ds_tools.uri_type</H2>
<H3>Synposis</H3>
Information about a URI.
<P>
<B>
<PRE>
ds_tools.uri_type AS (
  scheme text,
  userInfo text,
  hostText text,
  IPv4 bytea,
  IPv6 bytea,
  ipFuture text,
  portText text,
  path text[],
  query text,
  fragment text,
  absolutePath boolean,
  key text[],
  value text[]
);
</PRE>
</B>
<H3>About</H3>
A URI (URL or URN) is represented by its components:
<PRE>
scheme://userInfo@hostText:portText/path?query#fragment
</PRE>
<P>
If the host name is numeric in either IPv4 or IPv6 format, it is parsed and
represented in either the "IPv4" or "IPv6" element. "ipFuture" is meant to
support additional formats in the future.
<P>
"path" is stored as an array of path components, so "/usr/local/lib" is
parsed as ['usr','local','lib'].
<P>
"absolutePath" is a Boolean, indicating whether a file path is absolute
or relative.
<P>
"key" and "value", if not NULL, are parsed versions of the query string.
key[i] and value[i] hold the information for the i'th key-value pair in
the query string.
<H2>Type: ds_tools.uri_array_type</H2>
<H3>Synopsis</H3>
Information about an ordered collection of URI.
<B>
<PRE>
ds_tools.uri_array_type AS (
  scheme text[],
  userInfo text[],
  hostText text[],
  IPv4 bytea[],
  IPv6 bytea[],
  ipFuture text[],
  portText text[],
  path text[],
  query text[],
  fragment text[],
  absolutePath boolean[],
  uri text[]
);
</PRE>
</B>
<H3>About</H3>
Same as uri_type, but each element is an array, holding data for the
entire collection.
<P>
Additionally:
<BR>
"path" is kept unparsed, as a single "/"-separated string, for each URI.
key-value pairs are not extracted from the query.
The original uri is kept in the variable "uri", in its original form.
<H2>Function: ds_tools.parse_uri</H2>
<H3>Synopsis</H3>
Parse a URI into its components.
<P>
<TT>
<B>
ds_tools.parse_uri(uri text, normalize boolean, parse_query boolean)
RETURNS ds_tools.uri_type
</B>
</TT>
<H3>About</H3>
A row function, parsing URIs in text format to parsed URIs in uri_type.
<H3>Usage</H3>
<TABLE>
<TR>
<TD>
<TT>
uri
</TT>
</TD>
<TD>
original URI in text form.
</TD>
</TR>
<TR>
<TD>
<TT>
normalize
</TT>
</TD>
<TD>
Boolean stating whether parsed URI should be returned in
normalized form (e.g. with lowercase domain name and consistent
handling of special characters).
</TD>
</TR>
<TR>
<TD>
<TT>
parse_query
</TT>
</TD>
<TD>
Boolean stating whether query portion should be separated into
key-value pairs. If not, "key" and "value are returned NULLs.
</TD>
</TR>
</TABLE>
<H3>Example</H3>
<PRE>
SELECT ds_tools.parse_uri('http://myself:password@www.goPivotal.com:80/%7ehello/to/you/index.html?who=I&whom=me#here',true,true);
                                                       parse_uri                                                        
------------------------------------------------------------------------------------------------------------------------
 (http,myself:password,www.gopivotal.com,,,,80,"{~hello,to,you,index.html}",who=I&whom=me,here,f,"{who,whom}","{I,me}")
(1 row)
</PRE>
<H3>Prerequisites</H3>
Requires external library "uriparser".
<H2>Function: ds_tools.extract_uri</H2>
<H3>Synopsis</H3>
Extract all URIs embedded in text input.
<P>
<TT>
<B>
CREATE OR REPLACE FUNCTION ds_tools.extract_uri(txt text, normalize boolean)
RETURNS ds_tools.uri_array_type
</B>
</TT>
<H3>About</H3>
A row function, extracting uri_array_type from a text field.
<H3>Usage</H3>
<TABLE>
<TR>
<TD>
<TT>
txt
</TT>
</TD>
<TD>
Text from which URIs are to be extracted.
</TD>
</TR>
<TR>
<TD>
<TT>
normalize
</TT>
</TD>
<TD>
Boolean stating whether parsed URIs should be returned in
normalized form (e.g. with lowercase domain names and consistent
handling of special characters).
</TD>
</TR>
</TABLE>
<H3>Example</H3>
<PRE>
SELECT ds_tools.extract_uri('First go to http://[0123:4567:89ab:cdef:0123:4567:89ab:cdef]/ then go to https://192.165.0.1/ and repeat.',true);
                                                                                                                                                           extract_uri                                                                                                                                                           
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 ("{http,https}","{"""",""""}","{0123:4567:89ab:cdef:0123:4567:89ab:cdef,192.165.0.1}","{"""",300245000001}","{001043105147211253315357001043105147211253315357,""""}","{"""",""""}","{"""",""""}","{"""",""""}","{"""",""""}","{"""",""""}","{f,f}","{http://[0123:4567:89ab:cdef:0123:4567:89ab:cdef]/,https://192.165.0.1/}")
(1 row)
</PRE>
<H3>Prerequisites</H3>
Requires external library "uriparser".
<H2>Function: ds_tools.parse_domain</H2>
<H3>Synopsis</H3>
Parse a URI domain into its components.
<P>
<TT>
<B>
ds_tools.parse_domain(domainname text)
RETURNS text[]
</B>
</TT>
<H3>About</H3>
A row function, parsing a textual hierarchical domain name into components.
<H3>Usage</H3>
<TABLE>
<TR>
<TD>
<TT>
domainname
</TT>
</TD>
<TD>
Domain to be parsed.
</TD>
</TR>
</TABLE>
<H3>Example</H3>
<PRE>
SELECT ds_tools.parse_domain('www.gopivotal.com');
    parse_domain
---------------------
 {www,gopivotal,com}
(1 row)
</PRE>
<H3>Prerequisites</H3>
None
</BODY>
</HTML>
