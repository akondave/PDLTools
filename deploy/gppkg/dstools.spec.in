%define _topdir           @CMAKE_CURRENT_BINARY_DIR@/@GPDB_VERSION@
%define __os_install_post %{nil}
%define _rpmfilename      @DSTOOLS_GPPKG_RPM_FILE_NAME@
%define _unpackaged_files_terminate_build 0
%define _dstools_version  @DSTOOLS_VERSION_STRING@

BuildRoot:      @DSTOOLS_GPPKG_RPM_SOURCE_DIR@
Summary:        DSTools for Greenplum Database
License:        @CPACK_RPM_PACKAGE_LICENSE@
Name:           dstools
Version:        @DSTOOLS_VERSION_STRING@
Release:        @DSTOOLS_GPPKG_RELEASE_NUMBER@
Group:          @CPACK_RPM_PACKAGE_GROUP@
Prefix:         /usr/local
AutoReq:        no
AutoProv:       no
BuildArch:      @CPACK_RPM_PACKAGE_ARCHITECTURE@
Provides:       /bin/sh

%description
@CPACK_RPM_PACKAGE_DESCRIPTION@

%prep
:

%install
if [ ! @DSTOOLS_GPPKG_RPM_SOURCE_DIR@ -ef $RPM_BUILD_ROOT ]
then
    mkdir -p $RPM_BUILD_ROOT
    ln -s @DSTOOLS_GPPKG_RPM_SOURCE_DIR@/* $RPM_BUILD_ROOT/
fi


%post
echo $RPM_INSTALL_PREFIX
echo "DONE"
ln -nsf $RPM_INSTALL_PREFIX/dstools/Versions/%{_dstools_version} $RPM_INSTALL_PREFIX/dstools/Current
ln -nsf $RPM_INSTALL_PREFIX/dstools/Current/bin $RPM_INSTALL_PREFIX/dstools/bin
ln -nsf $RPM_INSTALL_PREFIX/dstools/Current/doc $RPM_INSTALL_PREFIX/dstools/doc

%files
%((cd "@DSTOOLS_GPPKG_RPM_SOURCE_DIR@@CPACK_PACKAGING_INSTALL_PREFIX@" && find . \( -type f -or -type l \) | grep -E -v "^\./ports/.*" && find ./ports/greenplum \( -type f -or -type l \) | grep -E -v "^\./ports/greenplum/[[:digit:]]+\.[[:digit:]]+/.*" && find ./ports/greenplum/@GPDB_VERSION@ \( -type f -or -type l \)) | cut -c 2- | awk '{ print "\"@CPACK_PACKAGING_INSTALL_PREFIX@" $0 "\""}')
